<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="utf-8">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
      {{ dropzone.config() }}
      {{ dropzone.load_css() }}
   </head>
   <body>
   <div class="container" style="margin-top: 25px;">
      <div style="width: 100%; display: table;">
         <div style="display: table-row;">
            <!-- <img src="{{url_for('static', filename='imgs/MCTSSA.png')}}"/> -->
            <div style="width: 50%; display: table-cell; position: relative;">
               <h2 style="">Acronym Table-Builder</h2>
            </div>
         </div>
      </div>
      <div class="dropzone" style="border-style:dashed;">
         <div class="dz-message needsclick" style="align-items : center; justify-content: center;">
            <h3 style="align-items:center; justify-content:center;">Drag and drop file here</h3>
            <h4 style="">or</h4>
            <label>Browse for file</label>
         </div>
      </div>
      <h3 style="margin-top: 25px;">Uploaded files:</h3>
         <div class="header-container">
            <div class="row" style="width: 100%; text-align: center; font-weight: bold;">
               <div class="column column-name" style="">
               <div>Name</div>
               </div>
               <div class="column column-date" style="">
               <div>Date</div>
               </div>
               <div class="column column-size" style="">
               <div>Size</div>
               </div>
               <div class="column column-action" style="">
               <div>Action</div>
               </div>
            </div>
            <div class="line"></div>

            <div class="row fade-in-image nonvisible" style="width: 100%; text-align: center;" id="file-one">
               <div class="column column-name" style="">
               <div></div>
               </div>
               <div class="column column-date" style="">
               <div></div>
               </div>
               <div class="column column-size" style="">
               <div></div>
               </div>
               <div class="column column-action" style="" id="action-one">
                  <i class="fa-regular fa-file-word" onclick="getDocx()" id="ellipsis-one" style=""></i>
                  <i class="fa-regular fa-file-excel" onclick="openMenu(this)" id="ellipsis-one" style=""></i>
                  <i class="fa-regular fa-eye"></i>
                  <i class="fa-regular fa-trash-can"></i>
                  <!-- Create a How To on an explaination on what the buttons do at the bottom of the page -->
               </div>
            </div>
            <div class="line nonvisible" id="line-one"></div>

            <div class="row fade-in-image nonvisible" style="width: 100%; text-align: center;" id="file-two">
               <div class="column column-name" style="">
               <div></div>
               </div>
               <div class="column column-date" style="">
               <div></div>
               </div>
               <div class="column column-size" style="">
               <div></div>
               </div>
               <div class="column column-action" style="" id="action-two">
                  <i class="fa-solid fa-ellipsis" onclick="openMenu(this)" id="ellipsis-two"></i>
               </div>
            </div>
            <div class="line nonvisible" id="line-two"></div>

            <div class="row fade-in-image nonvisible" style="width: 100%; text-align: center;" id="file-three">
               <div class="column column-name" style="">
               <div></div>
               </div>
               <div class="column column-date" style="">
               <div></div>
               </div>
               <div class="column column-size" style="">
               <div></div>
               </div>
               <div class="column column-action" style="" id="action-three">
                  <i class="fa-solid fa-ellipsis" onclick="openMenu(this)" id="ellipsis-three"></i>
               </div>
            </div>
            <div class="line nonvisible" id="line-three"></div>
         </div>
   </div>
   <script>
   $(document).ready(function(){
      Dropzone.autoDiscover = false;
      $(".dropzone").dropzone({
      url: '/upload',
      width: 300,
      height: 300,
      progressBarWidth: '100%',
      maxFiles: 1,
      maxFileSize: '15MB',
      acceptedFiles: 'application/pdf, .doc, .docx, .xlsx',
      addRemoveLinks: true,
      init: function() {
         this.on("success", function(serverResponse) {
            // document.getElementById('download-btns').classList.remove('disabled');
            // let items = document.getElementsByClassName('action_btn submit');
            // for(var i = 0; i < items.length; i++) {
            //    items[i].style.color = 'blue';
            // }

            // const request = new XMLHttpRequest();
            // request.open('POST', `/get-docx/${JSON.stringify(fn)}`);
            // request.send();
            // // display uploaded filename under dropzone
            // document.getElementById('filename').textContent = fn;       
         });     
         // this.on("removedfile", function(file) {
         //    document.getElementById('download-btns').classList.add('disabled');
         //       let items = document.getElementsByClassName('action_btn submit');
         //       for(var i = 0; i < items.length; i++) {
         //          items[i].style.color = '';
         //       }               
         // });

         this.on("complete", function(file) {
            // // grab filename from dynamically added dz filename class
            let filenames = document.getElementsByClassName("dz-filename");
            let fn = filenames[0].innerText;
            console.log(fn);
            // let request = new XMLHttpRequest();
            // request.onreadystatechange = function() {
            //    if (request.status == 200) {
            //       alert(request.responseText);
            //    }else{
            //       alert(request.status);
            //    }
            // };
            // request.open('POST', `/get-docx/${JSON.stringify(fn)}`);
            // request.send();

            let filesize = document.getElementsByClassName("dz-size");
            let fs = filesize[0].innerText;
            console.log(fs);

            let today = new Date();
            let dd = String(today.getDate()).padStart(2, '0');
            let mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            let yyyy = today.getFullYear();

            today = mm + '/' + dd + '/' + yyyy;
            console.log(today)

            let filediv = document.getElementById("file-one");
            filediv.className = "row fade-in-image";
            filediv = filediv.querySelectorAll(".column");
            filediv[0].innerText = fn;
            filediv[1].innerText = today;
            filediv[2].innerText = fs;

            let linediv = document.getElementById("line-one").className = "line";

            // this.removeFile(file);
         });
      }
      });
   });

   function getDocx() {
      console.log("click");
      // // grab filename from dynamically added dz filename class
      let filenames = document.getElementsByClassName("dz-filename");
      let fn = filenames[0].innerText;
      console.log(fn);    
      fn = JSON.stringify(fn)
      window.location.href = '/get-docx/' + fn;
   }
   </script>
   {{ dropzone.load_js() }}
   </body>
</html>
